<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   width="900"
   height="420"
   viewBox="0 0 900 420"
   version="1.1"
   id="svg34"
   sodipodi:docname="raster_ray_iteration.svg"
   inkscape:version="1.4.3 (0d15f75, 2025-12-25)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview34"
     pagecolor="#505050"
     bordercolor="#eeeeee"
     borderopacity="1"
     inkscape:showpageshadow="0"
     inkscape:pageopacity="0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     showgrid="false"
     inkscape:zoom="0.53857967"
     inkscape:cx="268.29828"
     inkscape:cy="-182.88845"
     inkscape:window-width="1920"
     inkscape:window-height="1017"
     inkscape:window-x="-8"
     inkscape:window-y="-8"
     inkscape:window-maximized="1"
     inkscape:current-layer="svg34" />
  <defs
     id="defs3">
    <marker
       style="overflow:visible"
       id="marker38"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Colored triangle"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         transform="scale(0.5)"
         style="fill:context-fill;fill-rule:evenodd;stroke:context-stroke;stroke-width:2"
         d="M 5.77,0 -2.88,5 V -5 Z"
         id="path38" />
    </marker>
    <marker
       style="overflow:visible"
       id="marker34"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Triangle arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         transform="scale(0.5)"
         style="fill:context-stroke;fill-rule:evenodd;stroke:context-stroke;stroke-width:1pt"
         d="M 5.77,0 -2.88,5 V -5 Z"
         id="path34" />
    </marker>
    <marker
       style="overflow:visible"
       id="Triangle"
       refX="0"
       refY="0"
       orient="auto-start-reverse"
       inkscape:stockid="Triangle arrow"
       markerWidth="1"
       markerHeight="1"
       viewBox="0 0 1 1"
       inkscape:isstock="true"
       inkscape:collect="always"
       preserveAspectRatio="xMidYMid">
      <path
         transform="scale(0.5)"
         style="fill:context-stroke;fill-rule:evenodd;stroke:context-stroke;stroke-width:1pt"
         d="M 5.77,0 -2.88,5 V -5 Z"
         id="path135" />
    </marker>
    <style
       id="style1"><![CDATA[
      .title { font: 700 20px Arial, sans-serif; fill: #111827; }
      .label { font: 14px Arial, sans-serif; fill: #111827; }
      .small { font: 12px Arial, sans-serif; fill: #374151; }
      .mono { font: 12px "Consolas", "Courier New", monospace; fill: #111827; }

      .panel { fill: #ffffff; stroke: #111827; stroke-width: 2; }
      .callout { fill: #f9fafb; stroke: #d1d5db; stroke-width: 1.5; }

      .axis { stroke: #111827; stroke-width: 2; fill: none; marker-end: url(#arrAxis); }
      .axisLabel { font: 700 12px Arial, sans-serif; fill: #111827; }

      .groundFill { fill: url(#hatch); opacity: 0.55; stroke: none; }
      .groundLine { fill: none; stroke: #111827; stroke-width: 3; stroke-linejoin: round; stroke-linecap: round; }

      .ray { stroke: #1d4ed8; stroke-width: 3; fill: none; stroke-dasharray: 8 6; marker-end: url(#arrBlue); }
      .iterArrow { stroke: #1d4ed8; stroke-width: 2.2; fill: none; marker-end: url(#arrBlueSmall); opacity: 0.95; }

      .planeLine { stroke: #f97316; stroke-width: 2; stroke-dasharray: 7 6; opacity: 0.9; }
      .sampleLine { stroke: #6b7280; stroke-width: 1.8; stroke-dasharray: 4 4; opacity: 0.95; }
      .initLine { stroke: #ef4444; stroke-width: 2.2; opacity: 0.9; }

      .ptCam { fill: #111827; }
      .ptIter { fill: #ffffff; stroke: #1d4ed8; stroke-width: 2; }
      .ptSample { fill: #f97316; stroke: #c2410c; stroke-width: 2; }
      .ptHit { fill: #10b981; stroke: #059669; stroke-width: 2; }
      .ptText { font: 700 12px Arial, sans-serif; fill: #1d4ed8; }
      .ptTextInv { font: 700 12px Arial, sans-serif; fill: #ffffff; }
    ]]></style>
    <pattern
       id="hatch"
       patternUnits="userSpaceOnUse"
       width="10"
       height="10"
       patternTransform="rotate(25)">
      <line
         x1="0"
         y1="0"
         x2="0"
         y2="10"
         stroke="#16a34a"
         stroke-width="2"
         opacity="0.35"
         id="line1" />
    </pattern>
    <marker
       id="arrAxis"
       markerWidth="12"
       markerHeight="10"
       refX="10"
       refY="5"
       orient="auto">
      <polygon
         points="0,0 12,5 0,10"
         fill="#111827"
         id="polygon1" />
    </marker>
    <marker
       id="arrBlue"
       markerWidth="12"
       markerHeight="10"
       refX="10"
       refY="5"
       orient="auto">
      <polygon
         points="0,0 12,5 0,10"
         fill="#1d4ed8"
         id="polygon2" />
    </marker>
    <marker
       id="arrBlueSmall"
       markerWidth="10"
       markerHeight="8"
       refX="8"
       refY="4"
       orient="auto">
      <polygon
         points="0,0 10,4 0,8"
         fill="#1d4ed8"
         id="polygon3" />
    </marker>
  </defs>
  <text
     x="20"
     y="30"
     class="title"
     id="text3"
     style="font-style:normal;font-variant:normal;font-weight:700;font-stretch:normal;font-size:20px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'"
       id="tspan54">Iterative ray–raster intersection (MappingRaster)</tspan></text>
  <!-- Left panel: XZ (profile) view -->
  <rect
     x="30"
     y="60"
     width="430"
     height="320"
     class="panel"
     id="rect3"
     sodipodi:insensitive="true" />
  <text
     x="44"
     y="84"
     class="label"
     id="text4"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:14px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial"
       id="tspan39">Profile view (X–Z): update plane height from sampled raster height</tspan></text>
  <!-- Axes -->
  <path
     d="M70,350 L420,350"
     class="axis"
     id="path5"
     style="stroke-width:1;stroke-dasharray:none;marker-end:url(#Triangle)" />
  <path
     d="M70,350 L70,130"
     class="axis"
     id="path6"
     style="marker-end:url(#marker34);stroke-width:1;stroke-dasharray:none" />
  <text
     x="426"
     y="354"
     class="axisLabel"
     id="text6"
     style="font-style:normal;font-variant:normal;font-weight:700;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'"
       id="tspan43">X</tspan></text>
  <text
     x="55.602398"
     y="131.6024"
     class="axisLabel"
     id="text7"
     style="font-style:normal;font-variant:normal;font-weight:700;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'"
       id="tspan44">Z</tspan></text>
  <!-- Terrain profile (schematic cross-section along the ray direction) -->
  <path
     class="groundFill"
     d="M 70,350 V 270 L 140,260 200,280 240,320 275,315 300,300 321,286 335,240 319.53089,288.26619 332.25459,283.34369 428.48109,239.41932 420,350 Z"
     id="path7"
     sodipodi:nodetypes="cccccccccccccc" />
  <path
     class="groundLine"
     d="M 70,270 140,260 200,280 240,320 275,315 300,300 321,286 364.84088,262.30213 381.09734,250.57244 403.55859,241.88057 429.10932,239.41931"
     id="path8"
     sodipodi:nodetypes="ccccccccccc" />
  <!-- Ray -->
  <path
     d="M 120.39065,138.837 372.73685,329.58215"
     class="ray"
     id="path9"
     style="marker-end:url(#marker38);stroke-width:2.5;stroke-dasharray:6.66666651,5;stroke-dashoffset:0"
     sodipodi:nodetypes="cc" />
  <circle
     cx="120"
     cy="140"
     r="5.5"
     class="ptCam"
     id="circle9" />
  <text
     x="132"
     y="144"
     class="small"
     id="text9"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial"
       id="tspan40">ray start (camera)</tspan></text>
  <!-- Initial ground height below ray start (used for initial guess) -->
  <path
     d="M120,140 L120,263"
     class="initLine"
     id="path10" />
  <circle
     cx="120"
     cy="263"
     r="4.5"
     class="ptSample"
     id="circle10" />
  <circle
     cx="322.38846"
     cy="138.81505"
     r="4.5"
     class="ptSample"
     id="circle10-1"
     style="fill:#f97316;stroke:#c2410c;stroke-width:2" />
  <text
     x="128.54474"
     y="256.69186"
     class="small"
     id="text10"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial"
       id="tspan41">initial height sample</tspan></text>
  <!-- Iteration planes z_i (horizontal) -->
  <path
     d="M 302.19602,276.09016 H 343.64721"
     class="planeLine"
     id="path11" />
  <path
     d="M 309.33995,282.82703 H 328.89143"
     class="planeLine"
     id="path11-9"
     style="opacity:0.9;stroke:#f97316;stroke-width:2;stroke-dasharray:7, 6" />
  <path
     d="M 304.68589,297.0251 H 328.63497"
     class="planeLine"
     id="path11-1"
     style="opacity:0.9;stroke:#f97316;stroke-width:2;stroke-dasharray:6.99997, 6" />
  <path
     d="M 283.00123,308.19317 H 344.57439"
     class="planeLine"
     id="path12" />
  <path
     d="M 118.73465,262.77537 H 283.67427"
     class="planeLine"
     id="path13" />
  <text
     x="100.61625"
     y="260.7514"
     class="small"
     id="text13"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif;fill:#c2410c;fill-opacity:1"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial;fill:#c2410c;fill-opacity:1"
       id="tspan46">z0</tspan></text>
  <text
     x="281.54623"
     y="321.58627"
     class="small"
     id="text14"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif;writing-mode:lr-tb;fill:#c2410c;fill-opacity:1"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial;fill:#c2410c;fill-opacity:1"
       id="tspan38">z1</tspan></text>
  <text
     x="347.51028"
     y="281.59042"
     class="small"
     id="text15"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif;fill:#c2410c;fill-opacity:1"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial;fill:#c2410c;fill-opacity:1"
       id="tspan45">z2</tspan></text>
  <text
     x="289.05203"
     y="292.27432"
     class="small"
     id="text15-1"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif;fill:#c2410c;fill-opacity:1"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial"
       id="tspan51">z3</tspan></text>
  <!-- Iteration points: p_i = ray ∩ plane(z_i) -->
  <text
     x="343.24631"
     y="320.2782"
     text-anchor="middle"
     class="ptText"
     id="text17"
     style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'">1</text>
  <text
     x="307.31619"
     y="273.87958"
     text-anchor="middle"
     class="ptText"
     id="text17-2"
     style="font-style:normal;font-variant:normal;font-weight:700;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif;fill:#1d4ed8"><tspan
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'"
       id="tspan50">2</tspan></text>
  <text
     x="326.81253"
     y="306.14703"
     text-anchor="middle"
     class="ptText"
     id="text17-2-8"
     style="font-style:normal;font-variant:normal;font-weight:700;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif;fill:#1d4ed8"><tspan
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'"
       id="tspan48">3</tspan></text>
  <!-- Sample raster height at (x_i, y_i): shown as vertical drops to the terrain profile -->
  <path
     d="M 342.31424,275.69924 V 308.47536"
     class="sampleLine"
     id="path18" />
  <path
     d="M 327.67536,282.17297 V 292.33021"
     class="sampleLine"
     id="path18-7"
     style="opacity:0.95;stroke:#6b7280;stroke-width:1.8;stroke-dasharray:4.00002, 4.00002" />
  <path
     d="M 284.50693,261.93636 V 307.20479"
     class="sampleLine"
     id="path19" />
  <path
     d="M 303.09162,276.19041 V 296.01556"
     class="sampleLine"
     id="path19-1"
     style="opacity:0.95;stroke:#6b7280;stroke-width:1.8;stroke-dasharray:4, 4" />
  <circle
     cx="342.35825"
     cy="275.12421"
     class="ptSample"
     id="circle19"
     r="2"
     style="stroke-width:1;stroke-dasharray:none" />
  <circle
     cx="327.70099"
     cy="282.31937"
     class="ptSample"
     id="circle19-7"
     style="fill:#f97316;stroke:#c2410c;stroke-width:1;stroke-dasharray:none"
     r="2.5" />
  <circle
     cx="310.4245"
     cy="292.35449"
     class="ptSample"
     id="circle19-7-3"
     style="fill:#f97316;stroke:#c2410c;stroke-width:1;stroke-dasharray:none"
     r="2.5" />
  <circle
     cx="285.01752"
     cy="308.48358"
     class="ptSample"
     id="circle19-7-5"
     style="fill:#f97316;stroke:#c2410c;stroke-width:1;stroke-dasharray:none"
     r="2.5" />
  <text
     x="332.48013"
     y="141.61882"
     class="small"
     id="text20"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial;-inkscape-font-specification:Arial">sampled heights</text>
  <!-- Converged hit (schematic): ray meets terrain -->
  <circle
     cx="318.48709"
     cy="287.62326"
     class="ptHit"
     id="circle21"
     r="6" />
  <text
     x="318.48709"
     y="291.64908"
     text-anchor="middle"
     class="ptTextInv"
     id="text21"
     style="font-style:normal;font-variant:normal;font-weight:700;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'"
       id="tspan52">N</tspan></text>
  <text
     x="-116.06966"
     y="407.70544"
     class="small"
     id="text22"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"
     transform="rotate(-65.948151)"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial"
       id="tspan47">hit (converged)</tspan></text>
  <!-- Iteration arrows along the ray (conceptual progress) -->
  <text
     x="70"
     y="367.11945"
     class="small"
     id="text25"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:Arial;-inkscape-font-specification:Arial"
       id="tspan42">Numbered points: successive ray ∩ plane(zᵢ) intersections</tspan></text>
  <!-- Right panel: algorithm summary -->
  <rect
     x="490"
     y="60"
     width="380"
     height="320"
     class="panel"
     id="rect25" />
  <text
     x="502.6871"
     y="84"
     class="label"
     id="text26"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:14px;line-height:normal;font-family:Arial, sans-serif">Per-ray iteration (simplified)</text>
  <text
     x="520"
     y="208"
     class="mono"
     id="text30"
     style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Consolas, 'Courier New', monospace;white-space:pre;inline-size:362.612"
     transform="translate(-19.693655,-93.21663)"
     xml:space="preserve"><tspan
       x="520"
       y="208"
       id="tspan2"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan1">1) Transform ray start to mapper CRS to get </tspan></tspan><tspan
       x="520"
       y="223.1105"
       id="tspan4"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan3">initial height -&gt; transform ray start XY + inital </tspan></tspan><tspan
       x="520"
       y="238.221"
       id="tspan6"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan5">height back to ray CRS -&gt; 1st intersection
</tspan></tspan><tspan
       x="520"
       y="253.33151"
       id="tspan8"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan7">
</tspan></tspan><tspan
       x="520"
       y="268.44201"
       id="tspan10"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan9">2) intersection point in ray CRS -&gt; transform to </tspan></tspan><tspan
       x="520"
       y="283.55252"
       id="tspan12"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan11">mapper CRS -&gt; sample height from raster
</tspan></tspan><tspan
       x="520"
       y="298.66302"
       id="tspan14"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan13">
</tspan></tspan><tspan
       x="520"
       y="313.77352"
       id="tspan16"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan15">3) transform intersection point XY + sampeld Z </tspan></tspan><tspan
       x="520"
       y="328.88403"
       id="tspan18"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan17">back to ray CRS -&gt; estimate new ray-plane </tspan></tspan><tspan
       x="520"
       y="343.99453"
       id="tspan20"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan19">intersection
</tspan></tspan><tspan
       x="520"
       y="359.10504"
       id="tspan22"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan21">
</tspan></tspan><tspan
       x="520"
       y="374.21554"
       id="tspan24"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan23">4) repeat (2)&amp;(3) until change of heights is under </tspan></tspan><tspan
       x="520"
       y="389.32604"
       id="tspan26"><tspan
         style="font-weight:bold;font-family:'Courier New';-inkscape-font-specification:'Courier New Bold'"
         id="tspan25">2cm or 40 itterations are reached</tspan></tspan></text>
  <text
     x="289.03372"
     y="260.0715"
     text-anchor="middle"
     class="ptText"
     id="text16"
     style="font-style:normal;font-variant:normal;font-weight:700;font-stretch:normal;font-size:12px;line-height:normal;font-family:Arial, sans-serif"><tspan
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-family:Arial;-inkscape-font-specification:'Arial Bold'"
       id="tspan49">0</tspan></text>
  <circle
     cx="303.9267"
     cy="296.71008"
     class="ptSample"
     id="circle19-2"
     r="2"
     style="fill:#f97316;stroke:#c2410c;stroke-width:1;stroke-dasharray:none" />
</svg>
